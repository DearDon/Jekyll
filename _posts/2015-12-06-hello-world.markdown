---
layout: post
title: "hello, world!"
date: 2015-12-06 13:27:00
categories: self diary update
---
我来了，博客君!

今天折腾了两件事，一件是用jekyll写静态网页，还有一件就是在阿里云centos7上装了个VNP，想用来代理上网。结果终于折腾完成了，想要记下其中的问题作为借鉴，却基本上忘得八九不离十了,这记性~~~<br> 
所以做了个决定，本来在思路不清的情况下不想写这种可能坑人坑自己的文章，但是防止忘得一干二净，还是把查到的东西东拼西凑一下吧！

###阿里云ECS上64位centos7搭建可用于访问外网的VPN
前篇说下在centos7上VPN服务器建立的背景，当时由于买了个阿里ECS，想着不能浪费了，就考虑该在上面折腾点啥，结果就想到了VPN，翻墙的厉器啊！几经折腾，终于能通过阿里云服务器上网了，可是便宜的服务器是青岛的，还是墙不出去...冷静之后转念一想，由于自己是移动的网（确实不稳定啊），想想没准用阿里来代理上国内网也能快点呢，当个游戏加速用。但发现自己还是天真了，连上阿里VPN后ping qq.com平均120ms以上、TTL＝50，不连VPN时只用平均70ms、TTL＝47，看来即使是强大的阿里做中转，绕远路还是比较慢啊。所以结果就是瞎折腾了！！ <br>
好了，牢骚说了一堆，下面说说具体的搭建吧。

step1搭建环节：首先自然是网上搜现成的案例过程，翻不了google，百度一搜还真是一大把，但是基本内容都是一样的（各种互转啊，要找到点新内容就像海里捞针似的）。这里我也就直接转转啦，不过是我实际搭建VPN时操作的，应该还算可靠。<br> 
VPN环境搭建流程同时参考了以下链接：<br>
<http://www.wanghailin.cn/centos-7-vpn/> <br>
<http://www.codeceo.com/article/centos7-vpn-server.html> <br>
<http://bbs.aliyun.com/read/162297.html>  <br>
<http://blog.csdn.net/johnnycode/article/details/45543157> <br>
为什么一个常规的搭建流程要参考这么多呢？因为里面没有一个，同时满足在阿里云ECS服务器，并且是64位centos7系统上用于代理上网的。而且由于是第一次搭建，难免很多不好把握，就多参考对比了。<br>
主要注意阿里是XEN架构的，所以iptables设置外网代理转发时要注意，而且外网网卡是eth1，此外要留意的是centos7与centos6明显的一个不同是默认的防火墙是firewalld，而不是iptables了，但是两者的管理命令都是iptable bla bla...的，然而有简单教程说明如何让centos7也使用iptables作为防火墙的，基本上解决这两点就可以连接VPN了。

step2答疑环节：然而，问题总是如期而至，记录下自己在VPN服务开启成功后遇到的两个问题:<br>
问题1:服务开启后，客户端能ping通服务器，但是连接报错（好像是651错误，请原谅我记不清了）。确定不是密码输错等无语原因后，最大可能是服务器的防火墙把VPN端口挡住了，可以先尝试关闭防火墙(假设用的是iptables,可用命令systemctl stop iptables.service)，再连接，如果可以连，则说明是防火墙的问题。这时可以用
iptables -A INPUT -p tcp --dport 1723 -j ACCEPT
打开pptpd默认的1723端口接收客户端的数据，这样打开防火墙也能连接了。这时可能有人会问了，那直接不要开防火墙不就可以少折腾很多事了，反正自己服务器也没有什么需要特殊保护的。这个是不行的，因为我们需要VPN来进行上网转发数据，这里要借用iptables的转发功能，所以得开启！！具体见问题2<br>
问题2;VPN终于正常连接了，但是问题来了，连上后居然不能上网了。如果没连VPN之前网终正常，连了后不能上网。首先一个好消息是本地数据确实如愿通过VPN到了远程服务器，而没有走本地的网络上网，完成了我们代理上网的想法。但是网络上不了，说明数据到了VPN服务器后就中断了。这时候主要问题在于VPN服务器的配置，首先要参考以上网页说明设置iptables的数据转发规则，注意是XEN架构的，而且外网网卡是eth1。但是还是代理上不了外网，可是直接SSH到服务器是可以访问外网的，说明仍旧配置有问题，最后发现了一个很好的帖子，里面总结了连网失败的解决办法<http://bbs.aliyun.com/read/163732.html?spm=5176.bbsr163732.0.0.DU3Vqo>。里面提到的iptables设置前要查看和清除旧规则很有用，因为规则是按顺序优先级检验的。另一个真正解决问题的就是设置mtu的问题，要把VPN连接的mtu设置为1500，然后奇迹般地可以代理上网了，不过网速比想像中慢就是了。

###Ubuntu10.04下搭建jekyll写github静态页面
这次是参考的github官方的说明，比较权威可靠。由于jekyll基于ruby，所以主要分为3步，安装ruby,bundler和jekyll。ruby是jekyll的语言环境，自不用多说，而bundler是为了以后的更新安装方便用的，严格来说，不装也是可以的，但是为了安装包的管理更新方便，强烈建议安装，这样才能方便地保证github后台的jekyll更新时能及时在本地跟上，使本地编写的与github上看到的页面效果一致（更新可是很频繁的喔）。<br>其实安装流程都是很明确的，主要问题在于版本，现在Ubuntu14.XX都早出来了，自己还守旧地用着停止更新支持的10.04。导致apt-get安装的程序都是很旧或是根本找不到软件包的，比如ruby就安装到1.8，而github里明确要求至少2.0。于是自己在apt-add了一个reposity，安装了2.0的ruby。而后就是bundler，用gem安装bundler时，发现国内不能连到默认的https://rubygems.org服务器，而替换为了可访问的https://ruby.tao.org。最后用bundler安装Jekyll也要设置该国内可访问的资源地址。
另外，在执行命令时可能出现没有javascript的runtime环境问题，可参考<https://github.com/rails/execjs>上网下载相应的环境，注意如果是用gem命令下的，只能在gem命令里使用该runtime环境，用bundle命令时仍然会报错，所以要用bundle安装该环境，方法就和安装jekyll差不多，在Gemfile里加上gem 'therubyracer'，还有后面加参数的形式，但是运行可能报错，不加参数实践证明也是OK的。至此环境安装成功。其中可能还会有些小问题，比如里面有个no什么什么的库一直报问题，注意要先下载了个c的dev环境库，具体可以直接搜那个缺少的包名的官方网站，上面有明确说明，而且说了在ubuntu,debian下不要用本地的那个包，要在线构建（网上就用说用这个本地构建的，也不说清楚系统状况，真是坑）。

不早了，今天写到这，把主要问题和内容都写了，下次再细细整理内容和排版吧。
